{% extends "main/base.html" %}
{% load static %}
{% block content %}
<div class="container my-5">
  <div class="card shadow p-4">
    <h2 class="text-center mb-4">401(k) Calculator</h2>

    {% if result %}
      <div class="alert alert-success text-center">
        <strong>Projected Balance at Retirement: ${{ result.projected_balance }}</strong>
      </div>
    {% endif %}

    {% if error %}
      <div class="alert alert-danger">{{ error }}</div>
    {% endif %}

    <form method="post">
      {% csrf_token %}
      <div class="mb-3">
        <label for="current_age">Current Age</label>
        <input type="number" class="form-control" name="current_age" value="{{ current_age|default:'' }}" required>
      </div>
      <div class="mb-3">
        <label for="retirement_age">Retirement Age</label>
        <input type="number" class="form-control" name="retirement_age" value="{{ retirement_age|default:'' }}" required>
      </div>
      <div class="mb-3">
        <label for="init_deposit">Initial Deposit ($)</label>
        <input type="number" class="form-control" name="init_deposit" value="{{ init_deposit|default:'' }}" required>
      </div>
      <div class="mb-3">
        <label for="salary">Annual Salary ($)</label>
        <input type="number" class="form-control" name="salary" value="{{ salary|default:'' }}" required>
      </div>
      <div class="mb-3">
        <label for="salary_growth_percent">Expected Salary Growth (%)</label>
        <input type="number" step="0.01" class="form-control" name="salary_growth_percent" value="{{ salary_growth_percent|default:'' }}" required>
      </div>
      <div class="mb-3">
        <label for="contribution_percent">Contribution (%)</label>
        <input type="number" step="0.01" class="form-control" name="contribution_percent" value="{{ contribution_percent|default:'' }}" required>
      </div>
      <div class="mb-3">
        <label for="employer_match_percent">Employer Match (%)</label>
        <input type="number" step="0.01" class="form-control" name="employer_match_percent" value="{{ employer_match_percent|default:'' }}" required>
      </div>
      <div class="mb-3">
        <label for="annual_yield">Annual Return (%)</label>
        <input type="number" step="0.01" class="form-control" name="annual_yield" value="{{ annual_yield|default:'' }}" required>
      </div>
      <button type="submit" class="btn btn-primary w-100">Calculate</button>
    </form>

    {% if result %}
      <div class="mt-5">
        <canvas id="growthChart" height="120"></canvas>
      </div>
    {% endif %}
  </div>
</div>

{% if result %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  const ctx = document.getElementById('growthChart').getContext('2d');
  const chartData = JSON.parse('{{ result.data_json|escapejs }}');
  const currentAge = {{ current_age }};

  new Chart(ctx, {
    type: 'line',
    data: {
      labels: chartData.map((_, i) => `Age ${i + currentAge}`),
      datasets: [{
        label: 'Projected Balance',
        data: chartData,
        borderColor: 'green',
        backgroundColor: 'rgba(0,200,83,0.1)',
        borderWidth: 2,
        fill: true
      }]
    },
    options: {
      responsive: true,
      scales: {
        y: {
          beginAtZero: true,
          title: {
            display: true,
            text: 'Balance ($)'
          }
        },
        x: {
          title: {
            display: true,
            text: 'Age'
          }
        }
      }
    }
  });
</script>
{% endif %}
{% endblock %}
