{% extends "main/base.html" %}
{% block content %}
<div class="container py-5">
  <div class="card shadow">
    <div class="card-body">
      <h2 class="text-center mb-4">Edit 401(k) Calculation</h2>

      {% if error %}
        <div class="alert alert-danger text-center">{{ error }}</div>
      {% endif %}

      <form method="post">
        {% csrf_token %}
        <div class="row g-3">

          <div class="col-md-6">
            <label for="current_age" class="form-label">Current Age</label>
            <input type="number" name="current_age" id="current_age" class="form-control" value="{{ entry.current_age }}" required>
          </div>

          <div class="col-md-6">
            <label for="retirement_age" class="form-label">Retirement Age</label>
            <input type="number" name="retirement_age" id="retirement_age" class="form-control" value="{{ entry.retirement_age }}" required>
          </div>

          <div class="col-md-6">
            <label for="init_deposit" class="form-label">Initial Deposit ($)</label>
            <input type="number" name="init_deposit" id="init_deposit" class="form-control" value="{{ entry.init_deposit }}" required>
          </div>

          <div class="col-md-6">
            <label for="salary" class="form-label">Annual Salary ($)</label>
            <input type="number" name="salary" id="salary" class="form-control" value="{{ entry.salary }}" required>
          </div>

          <div class="col-md-6">
            <label for="salary_growth_percent" class="form-label">Expected Salary Growth (%)</label>
            <input type="number" step="0.01" name="salary_growth_percent" id="salary_growth_percent" class="form-control" value="{{ entry.salary_growth }}" required>
          </div>

          <div class="col-md-6">
            <label for="contribution_percent" class="form-label">Contribution (%)</label>
            <input type="number" step="0.01" name="contribution_percent" id="contribution_percent" class="form-control" value="{{ entry.contribution }}" required>
          </div>

          <div class="col-md-6">
            <label for="employer_match_percent" class="form-label">Employer Match (%)</label>
            <input type="number" step="0.01" name="employer_match_percent" id="employer_match_percent" class="form-control" value="{{ entry.employer_match_percent|default_if_none:0 }}" required>
          </div>

          <div class="col-md-6">
            <label for="employer_match_limit" class="form-label">Employer Match Limit (%)</label>
            <input type="number" step="0.01" name="employer_match_limit" id="employer_match_limit" class="form-control" value="{{ entry.employer_match_limit|default_if_none:0 }}" required>
          </div>

          <div class="col-md-6">
            <label for="annual_yield" class="form-label">Annual Yield (%)</label>
            <input type="number" step="0.01" name="annual_yield" id="annual_yield" class="form-control" value="{{ entry.yield_rate }}" required>
          </div>
        </div>

        <button type="submit" class="btn btn-primary mt-4 w-100">Update Calculation</button>
      </form>

      {% if result %}
        <hr class="my-5">
        <h4 class="text-center">Updated Projection Preview</h4>
        <div style="max-width: 1000px; margin: auto;">
          <canvas id="projectionChart" height="250"></canvas>
        </div>
      {% endif %}

    </div>
  </div>
</div>

{% if result %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  const chartData = JSON.parse('{{ result.data_json|escapejs }}');
  const ctx = document.getElementById('projectionChart').getContext('2d');

  new Chart(ctx, {
    type: 'line',
    data: {
      labels: chartData.map((_, i) => `Year ${i + 1}`),
      datasets: [{
        label: 'Projected Balance',
        data: chartData,
        borderColor: 'green',
        backgroundColor: 'rgba(0,200,83,0.1)',
        borderWidth: 2,
        fill: true
      }]
    },
    options: {
      responsive: true,
      scales: {
        y: {
          beginAtZero: true,
          title: { display: true, text: 'Balance ($)' }
        },
        x: {
          title: { display: true, text: 'Years' }
        }
      }
    }
  });
</script>
{% endif %}
{% endblock %}
